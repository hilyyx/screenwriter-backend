from fastapi import APIRouter
from lib.models.schemas import Params, DialogueResponse
from lib.llm.generator import DialogGenerator

router = APIRouter()

class DialogueController:
    def __init__(self):
        self.generator_class = DialogGenerator

    def generate(self, params: Params):
        generator = self.generator_class(params.dict())
        generator.generate_structure()
        return generator.generate_dialogue()

dialogue_controller = DialogueController()

@router.post("/generate")
def generate(params: Params):
    b = {
  "data": [
    {
      "id": 1,
      "info": "NPC рассказывает о своей мечте стать великим изобретателем.",
      "type": "M",
      "mood": "воодушевлёный",
      "goal_achieve": 0,
      "to": [
        {
          "id": 2,
          "mood": "воодушевлёный",
          "line": {
            "line": "Знаешь, я тоже иногда боюсь не справиться с заданием, но потом вспоминаю, что важно просто стараться.",
            "info": "поддержка и понимание"
          }
        }
      ],
      "line": "\"Знаешь, я с детства мечтал изобрести что-то, что изменит мир! Представляешь, машину, которая превращает мусор в чистую энергию, или робота-учителя, который помогает детям учиться с удовольствием. Я уже набросал кучу чертежей в своей тетради — каждый вечер придумываю что-то новое! Может, когда-нибудь мои изобретения помогут людям жить лучше. Главное — не сдаваться и верить в свою мечту!\"",
      "meta": {}
    },
    {
      "id": 2,
      "info": "NPC делится своими страхами перед неудачей.",
      "type": "M",
      "mood": "испуганный",
      "goal_achieve": 0,
      "to": [
        {
          "id": 3,
          "mood": "нейтральный",
          "line": {
            "line": "Ты знаешь, даже великие изобретатели начинали с ошибок. Главное — не сдаваться и верить в себя. Я верю в тебя!",
            "info": "поддержка и вера"
          }
        }
      ],
      "line": "\"Спасибо, что понимаешь... Но знаешь, иногда мне кажется, что одного старания мало. Вдруг я потрачу годы на изобретения, а они никому не пригодятся? Или окажутся бесполезными? Я вижу, как другие изобретатели создают удивительные вещи, а у меня пока получаются только чертежи с ошибками... Мне так страшно, что моя мечта так и останется просто мечтой...\"",
      "meta": {}
    },
    {
      "id": 3,
      "info": "NPC спрашивает у героя, верит ли он в него.",
      "type": "C",
      "mood": "растерянный",
      "goal_achieve": 0,
      "to": [
        {
          "id": 4,
          "mood": "воодушевлёный",
          "line": {
            "line": "Конечно, я всегда буду рядом, чтобы поддержать тебя. Вместе мы справимся со всеми страхами и неудачами.",
            "info": "поддержка и ободрение"
          }
        },
        {
          "id": 5,
          "mood": "грустный",
          "line": {
            "line": "Если ты решишь бросить свою мечту из-за страха неудачи, то кто тогда воплотит все эти удивительные идеи в жизнь? Ты способен на большее, чем думаешь.",
            "info": "мотивация и вызов"
          }
        }
      ],
      "line": "\"Спасибо... Ты прав, наверное. Просто иногда кажется, что все вокруг уже чего-то добились, а я всё ещё топчусь на месте. Но если ты веришь в меня... Может, и правда стоит попробовать ещё раз? Даже если не получится сразу. Ты ведь будешь рядом, если мне снова станет страшно?\"",
      "meta": {}
    },
    {
      "id": 4,
      "info": "NPC благодарит героя за поддержку и решает продолжить свои изыскания.",
      "type": "P",
      "mood": "благодарный",
      "goal_achieve": 1,
      "to": [],
      "line": "\"Спасибо тебе... Ты прав, даже самые великие изобретатели когда-то ошибались. Твои слова согрели мне сердце, и теперь я чувствую, что могу свернуть горы! Я обязательно продолжу свои эксперименты, и пусть не всё получится с первого раза — я буду пробовать снова и снова. Ты мой самый настоящий друг, и с такой поддержкой мне не страшны никакие преграды. Может быть, однажды я изобрету что-то, что изменит мир... И ты будешь первым, кто это увидит!\"",
      "meta": {}
    },
    {
      "id": 5,
      "info": "NPC расстраивается из-за отсутствия веры в него и решает бросить свою мечту.",
      "type": "P",
      "mood": "грустный",
      "goal_achieve": 0,
      "to": [],
      "line": "\"Знаешь... Может, ты и прав, но... Мне кажется, я просто не создан для этого. Каждый раз, когда я пытаюсь что-то сделать, всё идёт не так. Даже мои родители говорят, что я зря трачу время. А если никто не верит, может, и правда стоит бросить? Мне так тяжело продолжать, когда вокруг только сомнения... Может, лучше просто забыть об изобретениях и заняться чем-то обычным...\"",
      "meta": {}
    }
  ]
}
    #a = dialogue_controller.generate(params)
    print(b)
    return b

