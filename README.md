# ๐ง Screenwriter Backend

ะัะพะตะบั backend-ัะตัะฒะธัะฐ ะดะปั ะณะตะฝะตัะฐัะธะธ ะธะฝัะตัะฐะบัะธะฒะฝัั ะดะธะฐะปะพะณะพะฒ ะผะตะถะดั ะณะปะฐะฒะฝัะผ ะณะตัะพะตะผ ะธ NPC ั ะธัะฟะพะปัะทะพะฒะฐะฝะธะตะผ LLM (Large Language Model). ะัะตะดะฝะฐะทะฝะฐัะตะฝ ะดะปั ััะตะฝะฐัะธััะพะฒ ะธ ัะฐะทัะฐะฑะพััะธะบะพะฒ ะธะณั.

---

## ๐ ะะพะทะผะพะถะฝะพััะธ

- ๐ฅ ะัะธะตะผ ะฟะฐัะฐะผะตััะพะฒ ะพ ะผะธัะต, ะฟะตััะพะฝะฐะถะต ะธ NPC ัะตัะตะท API.
- ๐ค ะะตะฝะตัะฐัะธั ััััะบัััั ะดะธะฐะปะพะณะฐ ะฒ ัะพัะผะฐัะต ะพัะธะตะฝัะธัะพะฒะฐะฝะฝะพะณะพ ะณัะฐัะฐ.
- ๐งฉ ะะฐะฑะพัะฐ ั LLM ัะตัะตะท API DeepSeek (ะธัะฟะพะปัะทัั JSON-ะฟัะพะผะฟัั).
- ๐ก๏ธ ะะฐะทะพะฒะฐั ัะธััะตะผะฐ ะฐะฒัะพัะธะทะฐัะธะธ (ัะตะณะธัััะฐัะธั / ะฒัะพะด).
- ๐พ ะะฐะฑะพัะฐ ั PostgreSQL ั ะปะพะณะธัะพะฒะฐะฝะธะตะผ ะฒัะตั ะดะตะนััะฒะธะน.
- ๐ ะงะตัะบะพ ะพัะณะฐะฝะธะทะพะฒะฐะฝะฝะฐั ะผะพะดัะปัะฝะฐั ะฐััะธัะตะบัััะฐ ะฟัะพะตะบัะฐ.

---

## ๐ฆ ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```bash
screenwriter-backend/
โโโ .env                      # ะฟะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั
โโโ .gitignore
โโโ pyproject.toml            # ะทะฐะฒะธัะธะผะพััะธ (poetry)
โโโ poetry.lock
โโโ README.md                 # ััะพั ัะฐะนะป

โโโ db/
โ   โโโ __init__.py
โ   โโโ database.py           # ะผะพะดัะปั ัะฐะฑะพัั ั PostgreSQL ะธ ะปะพะณะธัะพะฒะฐะฝะธะตะผ

โโโ lib/
โ   โโโ __init__.py
โ   โโโ settings.py           # ะณะปะพะฑะฐะปัะฝัะต ะฝะฐัััะพะนะบะธ
โ   โโโ auth/
โ   โ   โโโ __init__.py
โ   โ   โโโ auth.py           # ะปะพะณะธะบะฐ ะฐะฒัะพัะธะทะฐัะธะธ
โ   โโโ llm/
โ   โ   โโโ __init__.py
โ   โ   โโโ generator.py      # ะณะตะฝะตัะฐัะธั ะฟัะพะผะฟัะพะฒ ะธ ัะฐะฑะพัะฐ ั LLM
โ   โโโ models/
โ       โโโ __init__.py
โ       โโโ schemas.py        # ััะตะผั Pydantic

โโโ src/
โ   โโโ __init__.py
โ   โโโ app.py                # ะธะฝะธัะธะฐะปะธะทะฐัะธั FastAPI ะธ ะผะฐัััััะพะฒ
โ   โโโ main.py               # ัะพัะบะฐ ะฒัะพะดะฐ
โ   โโโ auth/
โ   โ   โโโ __init__.py
โ   โ   โโโ api/
โ   โ       โโโ __init__.py
โ   โ       โโโ auth_endpoint # ัััะบะธ /register ะธ /login
โ   โโโ llm/
โ       โโโ __init__.py
โ       โโโ api/
โ           โโโ __init__.py
โ           โโโ dialogue_endpoint # ัััะบะฐ /generate

โโโ resources/
โ   โโโ prompt_edges_content.txt
โ   โโโ prompt_nodes_content.txt
โ   โโโ prompt_structure.txt  # ัะฐะฑะปะพะฝั ะฟัะพะผะฟัะพะฒ

โโโ progress/
โ   โโโ 09_july.md
โ   โโโ 10_july.md
โ   โโโ ...                   # ะถััะฝะฐะป ะฟัะพะณัะตััะฐ ะฟะพ ะดะฝัะผ

โโโ db.log                    # ะปะพะณ ะทะฐะฟัะพัะพะฒ ะบ ะฑะฐะทะต ะดะฐะฝะฝัั
```

---

## ๐๏ธ ะฃััะฐะฝะพะฒะบะฐ

1. ะะปะพะฝะธััะน ัะตะฟะพะทะธัะพัะธะน:

```bash
git clone https://github.com/hilyyx/screenwriter-backend.git
cd screenwriter-backend
```

2. ะฃััะฐะฝะพะฒะธ ะทะฐะฒะธัะธะผะพััะธ ัะตัะตะท Poetry:

```bash
poetry install
```

3. ะกะพะทะดะฐะน ัะฐะนะป `.env` ะฒ ะบะพัะฝะต ะฟัะพะตะบัะฐ ะธ ัะบะฐะถะธ ัะฒะพะธ ะฟะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั:

```env
OPENAI_API_KEY=your-key-here
DATABASE_NAME=your_db
DATABASE_USER=your_user
DATABASE_PASSWORD=your_password
DATABASE_HOST=localhost
DATABASE_PORT=5432
```

4. ะะฐะฟัััะธ ัะตัะฒะตั ัะฐะทัะฐะฑะพัะบะธ:

```bash
poetry run uvicorn src.app:app --reload
```

---

## ๐ก ะญะฝะดะฟะพะธะฝัั

| ะะตัะพะด | URL              | ะะฟะธัะฐะฝะธะต            |
|-------|------------------|---------------------|
| POST  | `/api/generate`  | ะะตะฝะตัะฐัะธั ะดะธะฐะปะพะณะฐ   |
| POST  | `/api/login`     | ะัะพะด                |
| POST  | `/api/register`  | ะะตะณะธัััะฐัะธั         |

---

## ๐พ ะะฐะฑะพัะฐ ั ะฑะฐะทะพะน ะดะฐะฝะฝัั

ะะพะดัะปั `db/database.py` ัะตะฐะปะธะทัะตั ะฟะพะปะฝะพัะตะฝะฝัั ัะฐะฑะพัั ั PostgreSQL:

- ะะพะดะดะตัะถะธะฒะฐัััั CRUD-ะพะฟะตัะฐัะธะธ ะดะปั:
  - ะะพะปัะทะพะฒะฐัะตะปะตะน (`users`)
  - ะะณั (`games`)
  - ะกัะตะฝ (`scenes`)
  - ะะธะฐะปะพะณะพะฒ (`dialogues`)
  - ะะตััะพะฝะฐะถะตะน (`characters`)
- ะัะต SQL-ะทะฐะฟัะพัั ะปะพะณะธัััััั ะฒ ัะฐะนะป `db.log` ั ะฒัะตะผะตะฝะฝัะผะธ ะผะตัะบะฐะผะธ.
- ะัะฟะพะปัะทัะตััั `RealDictCursor` ะดะปั ัะดะพะฑะฝะพะน ัะตัะธะฐะปะธะทะฐัะธะธ ัะตะทัะปััะฐัะพะฒ.

ะัะธะผะตั ะทะฐะฟะธัะธ ะฒ ะปะพะณ:

```
2025-07-09 14:00:01 [INFO] ะะพะดะบะปััะตะฝะธะต ะบ ะฑะฐะทะต ะดะฐะฝะฝัั ััะฟะตัะฝะพ
2025-07-09 14:00:03 [INFO] ะกะพะทะดะฐะฝ ะฟะพะปัะทะพะฒะฐัะตะปั: user@example.com
```

---

## ๐๏ธ ะัะพะณัะตัั ัะฐะทัะฐะฑะพัะบะธ

ะกะผะพััะธ [progress/09_july.md](progress/09_july.md) ะธ ะดััะณะธะต ัะฐะนะปั ะฒ ะดะธัะตะบัะพัะธะธ `progress/`.
